DDD学習ガイド（『ドメイン駆動設計 サンプルコード&FAQ V1.0.1』ベース）

目的
- DDDの目的（機能性と保守性の両立）を理解し、TypeScriptで実装・テストできる状態になる
- 戦術的設計（エンティティ/値オブジェクト/リポジトリ/ドメインサービス）と集約、ユースケース、CQRS（軽量）を段階的に習得

前提資料
- docs/ドメイン駆動設計サンプルコード_FAQ_V1.0.1.md
- docs/ドメイン駆動設計_モデリング_実装ガイド_V1.0.3.pdf.md（補助）

進め方（2–4週間想定、平日1–2h/日）
Week 0: 環境準備（0.5日）
- TypeScript/Jest/ESLint/Prettierが動作することを確認
- ディレクトリ雛形作成: src/domain, src/usecase, src/infrastructure, src/presentation, test

Week 1: 基礎とモデル表現
- 読む（FAQ）: 1章 DDD全般, 3章 エンティティ/値オブジェクト（3.1〜3.3）
- 演習1: 値オブジェクト
  - 例: `TaskName`, `MailAddress`（不変・生成時バリデーション）
- 演習2: エンティティ
  - 例: `Task`（create/reconstruct/状態遷移postpone・セッター禁止）
- チェックポイント: 「常に正しいインスタンス」になっているか（セッターや不整合生成ができない）

Week 2: リポジトリ/ユースケース/テスト
- 読む（FAQ）: 4章 リポジトリ（4.1, 4.2）, 7章 テスト（7.1〜7.4）
- 演習3: リポジトリ
  - `TaskRepository`インターフェイス（ドメイン層）とメモリ実装（インフラ層）
  - findById/insert/update とページング/並び替え用のenum（必要に応じて）
- 演習4: ユースケース
  - `CreateTaskUseCase`, `PostponeTaskUseCase`, `FetchTaskDetailUseCase`
  - ユースケース戻り値はDTOで返す
- 演習5: テスト
  - 値オブジェクト/エンティティのユニットテスト
  - ユースケースはリポジトリをモックしてユニットテスト
- チェックポイント: given-when-thenで観点が明確、ユースケースはWhatに集中しているか

Week 3: 集約/ドメインサービス/軽量CQRS
- 読む（FAQ）: 5章 集約, 6章 ドメインサービス, 8.4 クエリモデル（軽量CQRS）
- 演習6: 複数集約の整合性
  - 例: `Task`作成時に`ActivityHistory`を必ず生成（まずはユースケースで2リポジトリ）
  - 改善: ドメインサービス`TaskCreator`へ委譲（責務を最小化、命名は動詞+er）
- 演習7: クエリモデル
  - DTOと`TaskQueryService`（ユースケース層インターフェイス）
  - インフラ層実装は必要な項目のみSELECT（軽量化）。ユースケースから呼び出し
- チェックポイント: ドメイン知識はドメイン層、取得最適化はインフラ層に閉じ込められているか

Week 4（任意）: アーキテクチャ/例外/認証
- 読む（FAQ）: 8章 アーキテクチャ（例外処理/外部サービス/認証/責務の切り分け）
- 演習8: 例外方針
  - ドメイン例外→プレゼンテーション層で共通ハンドリング（APIならステータス/エラーボディ変換）
- 演習9: 認証情報の受け渡し
  - `UserSession`インターフェイス（ユースケース層）を引数経由で受け取りテスト容易性を担保

成果物（最低限）
- src/domain: 値オブジェクト, エンティティ, リポジトリIF, （必要なら）ファクトリ/ドメインサービス
- src/usecase: ユースケース, DTO, クエリサービスIF
- src/infrastructure: リポジトリ/クエリサービスの実装（最初はオンメモリ）
- test/**: 値オブジェクト/エンティティ/ユースケース/インフラ（結合が必要な箇所のみ）

型と責務のガイド
- 値オブジェクト: 不変・生成時バリデーション・表現はドメイン語彙
- エンティティ: create/reconstruct/ミューテーションのみ公開。セッター禁止
- リポジトリ: 集約単位の入出力に限定（Listのアナロジー）。ドメイン知識は持たない
- ユースケース: ドメインの公開操作を組み合わせる（What）。戻り値はDTO
- クエリモデル: ユースケース層で型定義、インフラでHow最適化

評価の目安
- テストがユースケース/ドメインの意図を表現している（観点を日本語で命名）
- 参照/更新の責務分離、層間の依存方向（インフラ→ドメイン/ユースケース）が守れている

追加リーディング
- FAQ: 5.1 複数集約の整合性（3手法の比較）
- モデリング/実装ガイド: 第2章, 第5章, 第8章

チェックリスト（着手順）
- [ ] 値オブジェクト/エンティティ実装とテスト
- [ ] リポジトリIFとオンメモリ実装
- [ ] 主要ユースケース3本とDTO/テスト
- [ ] ドメインサービス（必要最小限）
- [ ] クエリモデル/クエリサービス
- [ ] 例外方針/認証情報の受け渡し
